<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<body>
  <table style="width:100%">
    <tr colspan="4">
      <div>
        å‚è€ƒå¼€åœºæ—¶é—´:
        <input type="number" id="rawTimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="rawTimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="rawTimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        å‚è€ƒP1æ€»æ—¶é•¿:
        <input type="number" id="rawP1TimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="rawP1TimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="rawP1TimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        å‚è€ƒP2æ€»æ—¶é•¿:
        <input type="number" id="rawP2TimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="rawP2TimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="rawP2TimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        å‚è€ƒP3æ€»æ—¶é•¿:
        <input type="number" id="rawP3TimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="rawP3TimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="rawP3TimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        (ä¸ç”¨å¡«æœ€æœ«Pæ—¶é•¿)
      </div>
    </tr>
    <tr colspan="4">
      <div>
        ç›®æ ‡å¼€åœºæ—¶é—´:
        <input type="number" id="targetTimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="targetTimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="targetTimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        ç›®æ ‡P1æ€»æ—¶é•¿:
        <input type="number" id="targetP1TimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="targetP1TimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="targetP1TimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        ç›®æ ‡P2æ€»æ—¶é•¿:
        <input type="number" id="targetP2TimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="targetP2TimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="targetP2TimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        ç›®æ ‡P3æ€»æ—¶é•¿:
        <input type="number" id="targetP3TimeBoxH" value="0" min="0" max="5" style="width: 40px" />:
        <input type="number" id="targetP3TimeBoxM" value="0" min="0" max="59" style="width: 40px" />:
        <input type="number" id="targetP3TimeBoxS" value="0" min="0" max="59" style="width: 40px" />,
        <button id="execButton">è°ƒè½´</button>
      </div>
    </tr>
    <tr>
      <td><textarea name="input1" id="inputBox1" rows="15" style="width:95%" placeholder="å‚è€ƒP1æ—¶é—´è½´" value=""> </textarea></td>
      <td><textarea name="input2" id="inputBox2" rows="15" style="width:95%" placeholder="å‚è€ƒP2æ—¶é—´è½´" value=""> </textarea></td>
      <td><textarea name="input3" id="inputBox3" rows="15" style="width:95%" placeholder="å‚è€ƒP3æ—¶é—´è½´" value=""> </textarea></td>
      <td><textarea name="input4" id="inputBox4" rows="15" style="width:95%" placeholder="å‚è€ƒP4æ—¶é—´è½´" value=""> </textarea></td>
    </tr>
    <tr>
      <td><textarea name="output1" id="outputBox1" rows="15" style="width:95%" placeholder="ç›®æ ‡P1æ—¶é—´è½´" value=""> </textarea></td>
      <td><textarea name="output2" id="outputBox2" rows="15" style="width:95%" placeholder="ç›®æ ‡P2æ—¶é—´è½´" value=""> </textarea></td>
      <td><textarea name="output3" id="outputBox3" rows="15" style="width:95%" placeholder="ç›®æ ‡P3æ—¶é—´è½´" value=""> </textarea></td>
      <td><textarea name="output4" id="outputBox4" rows="15" style="width:95%" placeholder="ç›®æ ‡P4æ—¶é—´è½´" value=""> </textarea></td>
    </tr>
  </table>

</body>
<script>
  const inputBox1 = document.getElementById("inputBox1");
  const inputBox2 = document.getElementById("inputBox2");
  const inputBox3 = document.getElementById("inputBox3");
  const inputBox4 = document.getElementById("inputBox4");

  const outputBox1 = document.getElementById("outputBox1");
  const outputBox2 = document.getElementById("outputBox2");
  const outputBox3 = document.getElementById("outputBox3");
  const outputBox4 = document.getElementById("outputBox4");

  const execButton = document.getElementById("execButton");

  const rawTimeBoxH = document.getElementById("rawTimeBoxH");
  const rawTimeBoxM = document.getElementById("rawTimeBoxM");
  const rawTimeBoxS = document.getElementById("rawTimeBoxS");

  const rawP1TimeBoxH = document.getElementById("rawP1TimeBoxH");
  const rawP1TimeBoxM = document.getElementById("rawP1TimeBoxM");
  const rawP1TimeBoxS = document.getElementById("rawP1TimeBoxS");

  const rawP2TimeBoxH = document.getElementById("rawP2TimeBoxH");
  const rawP2TimeBoxM = document.getElementById("rawP2TimeBoxM");
  const rawP2TimeBoxS = document.getElementById("rawP2TimeBoxS");

  const rawP3TimeBoxH = document.getElementById("rawP3TimeBoxH");
  const rawP3TimeBoxM = document.getElementById("rawP3TimeBoxM");
  const rawP3TimeBoxS = document.getElementById("rawP3TimeBoxS");

  const targetTimeBoxH = document.getElementById("targetTimeBoxH");
  const targetTimeBoxM = document.getElementById("targetTimeBoxM");
  const targetTimeBoxS = document.getElementById("targetTimeBoxS");

  const targetP1TimeBoxH = document.getElementById("targetP1TimeBoxH");
  const targetP1TimeBoxM = document.getElementById("targetP1TimeBoxM");
  const targetP1TimeBoxS = document.getElementById("targetP1TimeBoxS");

  const targetP2TimeBoxH = document.getElementById("targetP2TimeBoxH");
  const targetP2TimeBoxM = document.getElementById("targetP2TimeBoxM");
  const targetP2TimeBoxS = document.getElementById("targetP2TimeBoxS");

  const targetP3TimeBoxH = document.getElementById("targetP3TimeBoxH");
  const targetP3TimeBoxM = document.getElementById("targetP3TimeBoxM");
  const targetP3TimeBoxS = document.getElementById("targetP3TimeBoxS");

  inputBox1.value = "";
  inputBox2.value = "";
  inputBox3.value = "";
  inputBox4.value = "";

  outputBox1.value = "";
  outputBox2.value = "";
  outputBox3.value = "";
  outputBox4.value = "";

  const timeRegex = /^([0-2]?\d{1})\:([0-5]{1}\d{1})\:([0-5]{1}\d{1})$/
  const timeRegex2 = /^([0-5]?\d{1})\:([0-5]{1}\d{1})$/
  execButton.onclick = function () {
    const inputStrList1 = inputBox1.value.split(/\n+/);
    const inputStrList2 = inputBox2.value.split(/\n+/);
    const inputStrList3 = inputBox3.value.split(/\n+/);
    const inputStrList4 = inputBox4.value.split(/\n+/);

    const offsetRaw1 = -(parseInt(rawTimeBoxH.value) * 3600 + parseInt(rawTimeBoxM.value) * 60 + parseInt(rawTimeBoxS
      .value));
    const offsetRaw2 = offsetRaw1 + parseInt(rawP1TimeBoxH.value) * 3600 + parseInt(rawP1TimeBoxM.value) * 60 +
      parseInt(rawP1TimeBoxS.value);
    const offsetRaw3 = offsetRaw2 + parseInt(rawP2TimeBoxH.value) * 3600 + parseInt(rawP2TimeBoxM.value) * 60 +
      parseInt(rawP2TimeBoxS.value);
    const offsetRaw4 = offsetRaw3 + parseInt(rawP3TimeBoxH.value) * 3600 + parseInt(rawP3TimeBoxM.value) * 60 +
      parseInt(rawP3TimeBoxS.value);
    const offsetRaw = [offsetRaw1, offsetRaw2, offsetRaw3, offsetRaw4];

    const offsetTarget1 = -(parseInt(targetTimeBoxH.value) * 3600 + parseInt(targetTimeBoxM.value) * 60 + parseInt(
      targetTimeBoxS.value));
    var local1 = parseInt(targetP1TimeBoxH.value) * 3600 + parseInt(targetP1TimeBoxM.value) * 60 + parseInt(
      targetP1TimeBoxS.value);
    if (local1 == 0)
      local1 = Infinity
    const offsetTarget2 = offsetTarget1 + local1;
    var local2 = parseInt(targetP2TimeBoxH.value) * 3600 + parseInt(targetP2TimeBoxM.value) * 60 + parseInt(
      targetP2TimeBoxS.value);
    if (local2 == 0)
      local2 = Infinity
    const offsetTarget3 = offsetTarget2 + local2;
    var local3 = parseInt(targetP3TimeBoxH.value) * 3600 + parseInt(targetP3TimeBoxM.value) * 60 + parseInt(
      targetP3TimeBoxS.value);
    if (local3 == 0)
      local3 = Infinity
    const offsetTarget4 = offsetTarget3 + local3;

    var outputStrList1 = [];
    var outputStrList2 = [];
    var outputStrList3 = [];
    var outputStrList4 = [];

    handlePart = function(part) {
      if (part.endsWith('**')) {
        part = 'ğŸŒŸ '+ part.slice(0, part.length - 2)
      } else if (part.endsWith('*')) {
        part = 'ğŸŒŸ '+ part.slice(0, part.length - 1)
      } else if (part.startsWith('ğŸ¤')) {
        part = 'ğŸ¤ '+ part.slice(2, part.length)
      } else if (part.startsWith('ğŸ’ƒ')) {
        part = 'ğŸ’ƒ '+ part.slice(2, part.length)
      } else {
        part = 'â– '+ part
      }
      return part
    }

    var currentDispatch = 0;
    [inputStrList1, inputStrList2, inputStrList3, inputStrList4].forEach((inputStrList, partIdx) => {
      const localOffset = offsetRaw[partIdx];

      inputStrList.forEach(inputStrItem => {
        const outputPart = [
          [],
          [],
          [],
          []
        ];
        const inputPart = inputStrItem.split(' ');
        inputPart.forEach(part => {
          if (part) {
            if (timeRegex.test(part) || timeRegex2.test(part)) {
              const timePart = part.split(":");
              var rawTime = localOffset;
              console.log(timePart, rawTime)
              if (timePart.length == 3) {
                rawTime += parseInt(timePart[0]) * 3600;
                rawTime += parseInt(timePart[1]) * 60;
                rawTime += parseInt(timePart[2]);
              } else {
                rawTime += parseInt(timePart[0]) * 60;
                rawTime += parseInt(timePart[1]);
              }
              console.log(timePart, rawTime)

              // check which part
              var targetTime = 0;
              if (rawTime < offsetTarget1) {
                targetTime = 0;
                currentDispatch = 0;
              } else if (rawTime < offsetTarget2) {
                targetTime = rawTime - offsetTarget1;
                currentDispatch = 0;
              } else if (rawTime < offsetTarget3) {
                targetTime = rawTime - offsetTarget2;
                currentDispatch = 1;
              } else if (rawTime < offsetTarget4) {
                targetTime = rawTime - offsetTarget3;
                currentDispatch = 2;
              } else {
                targetTime = rawTime - offsetTarget4;
                currentDispatch = 3;
              }

              var timeStr = "" + targetTime * 1000;
              outputPart[currentDispatch].push(timeStr);
            } else {
              outputPart[currentDispatch].push(part);
            }
          }
        })
        if (outputPart[0].length != 0) {
          timelineStr = outputPart[0].slice(1, outputPart[0].length).join("")
          outputStrList1.push(outputStrList1.length + "=" + outputPart[0][0] + "*" + handlePart(timelineStr) + "*")
        }
        if (outputPart[1].length != 0) {
          timelineStr = outputPart[1].slice(1, outputPart[1].length).join("")
          outputStrList2.push(outputStrList2.length + "=" + outputPart[1][0] + "*" + handlePart(timelineStr) + "*")
        }
        if (outputPart[2].length != 0) {
          timelineStr = outputPart[2].slice(1, outputPart[2].length).join("")
          outputStrList3.push(outputStrList3.length + "=" + outputPart[2][0] + "*" + handlePart(timelineStr) + "*")
        }
        if (outputPart[3].length != 0) {
          timelineStr = outputPart[3].slice(1, outputPart[3].length).join("")
          outputStrList4.push(outputStrList4.length + "=" + outputPart[3][0] + "*" + handlePart(timelineStr) + "*")
        }
      })

    })

    outputBox1.value = "[Bookmark]\n" + outputStrList1.join("\n");
    outputBox2.value = "[Bookmark]\n" + outputStrList2.join("\n");
    outputBox3.value = "[Bookmark]\n" + outputStrList3.join("\n");
    outputBox4.value = "[Bookmark]\n" + outputStrList4.join("\n");
  }
</script>

</html>
