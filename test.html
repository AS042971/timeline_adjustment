<div class="artplayer-app" style="width: auto; height: 60vh; position: relative;"></div>
<script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/artplayer-plugin-danmuku/dist/artplayer-plugin-danmuku.js"></script>
<script>
  var art = new Artplayer({
    container: document.querySelector('.artplayer-app'),
    url: 'https://jsxm.sharepoint.cn/sites/nf-asoul/_layouts/15/download.aspx?UniqueId=f83e9fde-5601-481b-80eb-5b52d8f54a54&Translate=false&tempauth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvanN4bS5zaGFyZXBvaW50LmNuQGE4Y2NjNDgzLTY1NjktNDlhMC1hNjYxLWQ2YTFmMTViOWZhMSIsImlzcyI6IjAwMDAwMDAzLTAwMDAtMGZmMS1jZTAwLTAwMDAwMDAwMDAwMCIsIm5iZiI6IjE2NDg1NTE2ODYiLCJleHAiOiIxNjQ4NTU1Mjg2IiwiZW5kcG9pbnR1cmwiOiJoeFBwSFllUTZwaTFWa21YTXBBV0dERmoxWDd4bTBiaUExM3o2QkVBUjlRPSIsImVuZHBvaW50dXJsTGVuZ3RoIjoiMTI5IiwiaXNsb29wYmFjayI6IlRydWUiLCJjaWQiOiJNVFZoT0RNeU9HTXRNVEZtTmkwMFl6Qm1MV0ZqTkdVdE16azJZMkZsTWpZeFlqUTEiLCJ2ZXIiOiJoYXNoZWRwcm9vZnRva2VuIiwic2l0ZWlkIjoiWVRCa00yTm1OVEl0WWpWaFppMDBPV013TFRneE4yVXRaakU0T0RJME16QTVZMll5IiwiYXBwX2Rpc3BsYXluYW1lIjoiQVNPVUwtQ04yIiwiYXBwaWQiOiJiZjM1OGQ4MC1kMWI5LTQ0NzktOTcxYi03ZjMxYzE0ZTNhNDkiLCJ0aWQiOiJhOGNjYzQ4My02NTY5LTQ5YTAtYTY2MS1kNmExZjE1YjlmYTEiLCJ1cG4iOiJta25haWZlbkBhc2YuaW5rIiwicHVpZCI6IjEwMDMzMjMwQzY0NkFEODUiLCJjYWNoZWtleSI6IjBoLmZ8bWVtYmVyc2hpcHwxMDAzMzIzMGM2NDZhZDg1QGxpdmUuY29tIiwic2NwIjoiYWxsc2l0ZXMucmVhZCBhbGxzaXRlcy53cml0ZSIsInR0IjoiMiIsInVzZVBlcnNpc3RlbnRDb29raWUiOm51bGwsImlwYWRkciI6IjUyLjEzMC4xMC4xNjEifQ.ZWtETVZtS2M2c3Q2UW1LWjRhQkpySEx1T2g2SnRFdXRHSlowc1RIdml6ND0&ApiVersion=2.0',
    plugins: [
      artplayerPluginDanmuku({
        danmuku: 'https://dm.asdanmaku.com/Xml/2021.12.11 【A-SOUL】周年特别直播.xml',
        speed: 11, // 全局持续时间
        opacity: 0.7, // 全局透明度
        size: 30, // 全局字体大小
        maxlength: 100, // 全局最大长度
        synchronousPlayback: true, // 是否同步到播放速度
      }),
    ],
    settings: [{
        width: 150,
        html: '弹幕开关',
        selector: [
          {
            default: true,
            html: '显示',
            showDanmuku: true
          },
          {
            html: '隐藏',
            showDanmuku: false
          },
        ],
        onSelect: function (item) {
          if (item.showDanmuku) {
            art.plugins.artplayerPluginDanmuku.show();
          } else {
            art.plugins.artplayerPluginDanmuku.hide();
          }
        },
      },
      {
        width: 150,
        html: '弹幕大小',
        selector:[
          {
            html: '很小 (12px)',
            size: 12
          },
          {
            html: '较小 (20px)',
            size: 20
          },
          {
            default: true,
            html: '适中 (30px)',
            size: 30
          },
          {
            html: '较大 (40px)',
            size: 40
          },
          {
            html: '很大 (50px)',
            size: 50
          }
        ],
        onSelect: function (item) {
          art.plugins.artplayerPluginDanmuku.config({
            fontSize: item.size,
          });
        },
      },
      {
        width: 150,
        html: '弹幕不透明度',
        selector:[
          {
            html: '30%',
            opacity: 0.3
          },
          {
            html: '50%',
            opacity: 0.5
          },
          {
            default: true,
            html: '70%',
            opacity: 0.7
          },
          {
            html: '90%',
            opacity: 0.9
          },
          {
            html: '100%',
            opacity: 1.0
          }
        ],
        onSelect: function (item) {
          art.plugins.artplayerPluginDanmuku.config({
            opacity: item.opacity,
          });
        },
      }
    ],
    setting: true,
    whitelist: ['*'],
    autoSize: true,
    autoMini: true,
    flip: true,
    volume: 0.5,
    rotate: true,
    playbackRate: true,
    hotkey: true,
    pip: true,
    fullscreen: true,
    fullscreenWeb: true,
  });

  fetch('https://asoul.knaifen.workers.dev/ASOUL-REC-二周年/PBF书签文件/2021.12.11 【A-SOUL】周年特别直播.pbf')
    .then(response => response.text())
    .then(rawPBFStr => {
      var highlight = []

      var rawPBFList = rawPBFStr.split(/[(\r\n)\r\n]+/);
      rawPBFList.shift()
      rawPBFList.forEach(PBFItem => {
        if (!PBFItem) {
          return
        }
        var PBFParts = PBFItem.split('*')
        var timeMarker = PBFParts.shift()
        var timeMarkerParts = timeMarker.split('=')
        var time = parseInt(timeMarkerParts[1]) / 1000
        var text = PBFParts[0]

        highlight.push({
          "time": time,
          "text": text
        });
      });
      art.option.highlight = highlight;
    })
</script>
