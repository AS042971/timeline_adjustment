<div class="artplayer-app" style="width: auto; height: 60vh; position: relative;"></div>
<script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/artplayer-plugin-danmuku/dist/artplayer-plugin-danmuku.js"></script>
<script>
  var art = new Artplayer({
    container: document.querySelector('.artplayer-app'),
    url: 'https://jsxm.sharepoint.cn/sites/nf-asoul/_layouts/15/download.aspx?UniqueId=2e8c4432-ee6c-455d-b53d-4d0eb7870a66&Translate=false&tempauth=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvanN4bS5zaGFyZXBvaW50LmNuQGE4Y2NjNDgzLTY1NjktNDlhMC1hNjYxLWQ2YTFmMTViOWZhMSIsImlzcyI6IjAwMDAwMDAzLTAwMDAtMGZmMS1jZTAwLTAwMDAwMDAwMDAwMCIsIm5iZiI6IjE2NDg1Njg4NDQiLCJleHAiOiIxNjQ4NTcyNDQ0IiwiZW5kcG9pbnR1cmwiOiJ0WG9abW16QjI4cTV3TnhjVzAyWTJsMzdVMmJjNlFlSExUMUVETUZjeTFJPSIsImVuZHBvaW50dXJsTGVuZ3RoIjoiMTI5IiwiaXNsb29wYmFjayI6IlRydWUiLCJjaWQiOiJaalU0WlRFME1qZ3RPR0psT0MwMFptUTFMV0V3WTJJdE1ESTJOREZoTnpJMU4yRTQiLCJ2ZXIiOiJoYXNoZWRwcm9vZnRva2VuIiwic2l0ZWlkIjoiWVRCa00yTm1OVEl0WWpWaFppMDBPV013TFRneE4yVXRaakU0T0RJME16QTVZMll5IiwiYXBwX2Rpc3BsYXluYW1lIjoiTkYtQVNPVUwiLCJhcHBpZCI6Ijk4ZGU0ZjE0LTZkMjUtNDAzMS1hNmVmLWEwMmUxMzQ0OTMwYyIsInRpZCI6ImE4Y2NjNDgzLTY1NjktNDlhMC1hNjYxLWQ2YTFmMTViOWZhMSIsInVwbiI6ImtuYWlmZW5AYXNmLmluayIsInB1aWQiOiIxMDAzMzIzMEM2NDZBRDg0IiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8MTAwMzMyMzBjNjQ2YWQ4NEBsaXZlLmNvbSIsInNjcCI6ImFsbHNpdGVzLnJlYWQgYWxsc2l0ZXMud3JpdGUiLCJ0dCI6IjIiLCJ1c2VQZXJzaXN0ZW50Q29va2llIjpudWxsLCJpcGFkZHIiOiI0MC43Mi43NC4xOTIifQ.emZVUnh3NitKNUdHVkhPSjZ1d0IycFVPNFliL09NNEV3U1krTmJXWE9EMD0&ApiVersion=2.0',
    plugins: [
      artplayerPluginDanmuku({
        danmuku: 'https://dm.asdanmaku.com/Xml/2022.01.12 珈乐 小狼水吧-拉乐摆.xml',
        speed: 11, // 全局持续时间
        opacity: 0.7, // 全局透明度
        size: 30, // 全局字体大小
        maxlength: 100, // 全局最大长度
        synchronousPlayback: true, // 是否同步到播放速度
        margin: [0, 0]
      }),
    ],
    settings: [{
        width: 150,
        html: '弹幕开关',
        selector: [
          {
            default: true,
            html: '显示',
            showDanmuku: true
          },
          {
            html: '隐藏',
            showDanmuku: false
          },
        ],
        onSelect: function (item) {
          if (item.showDanmuku) {
            art.plugins.artplayerPluginDanmuku.show();
          } else {
            art.plugins.artplayerPluginDanmuku.hide();
          }
        },
      },
      {
        width: 150,
        html: '弹幕大小',
        selector:[
          {
            html: '很小 (12px)',
            size: 12
          },
          {
            html: '较小 (20px)',
            size: 20
          },
          {
            default: true,
            html: '适中 (30px)',
            size: 30
          },
          {
            html: '较大 (40px)',
            size: 40
          },
          {
            html: '很大 (50px)',
            size: 50
          }
        ],
        onSelect: function (item) {
          art.plugins.artplayerPluginDanmuku.config({
            fontSize: item.size,
          }).margin[1] = art.height / 2;
        },
      },
      {
        width: 150,
        html: '弹幕不透明度',
        selector:[
          {
            html: '30%',
            opacity: 0.3
          },
          {
            html: '50%',
            opacity: 0.5
          },
          {
            default: true,
            html: '70%',
            opacity: 0.7
          },
          {
            html: '90%',
            opacity: 0.9
          },
          {
            html: '100%',
            opacity: 1.0
          }
        ],
        onSelect: function (item) {
          art.plugins.artplayerPluginDanmuku.config({
            opacity: item.opacity,
          }).margin[1] = art.height / 2;
        },
      }
    ],
    setting: true,
    whitelist: ['*'],
    autoSize: true,
    autoMini: true,
    flip: true,
    volume: 0.5,
    rotate: true,
    playbackRate: true,
    hotkey: true,
    pip: true,
    fullscreen: true,
    fullscreenWeb: true,
  });

  pluginOption = art.plugins.artplayerPluginDanmuku.config().option;
  art.on('resize', () => {
    pluginOption.margin[1] = art.height / 2;
  });

  fetch('https://asoul.knaifen.workers.dev/ASOUL-REC-二周年/PBF书签文件/2022.01.12 珈乐 小狼水吧-拉乐摆.pbf')
    .then(response => response.text())
    .then(rawPBFStr => {
      var highlight = []

      var rawPBFList = rawPBFStr.split(/[(\r\n)\r\n]+/);
      rawPBFList.shift()
      rawPBFList.forEach(PBFItem => {
        if (!PBFItem) {
          return
        }
        var PBFParts = PBFItem.split('*')
        var timeMarker = PBFParts.shift()
        var timeMarkerParts = timeMarker.split('=')
        var time = parseInt(timeMarkerParts[1]) / 1000
        var text = PBFParts[0]

        highlight.push({
          "time": time,
          "text": text
        });
      });
      art.option.highlight = highlight;
    })
</script>
